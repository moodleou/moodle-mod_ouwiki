define("mod_ouwiki/main",["exports","core/str","core/pending"],(function(_exports,_str,_pending){var obj;
/**
   * JavaScript to handle ouwiki.
   *
   * @module mod_ouwiki/main
   * @copyright 2024 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};class Main{constructor(){}init(){const iconShow=document.getElementById("showannotationicons"),iconHide=document.getElementById("hideannotationicons");iconShow&&iconShow.addEventListener("click",(e=>{e.preventDefault(),this.showAnnotationIcons(!0),setTimeout((()=>{var _document$getElementB;return null===(_document$getElementB=document.getElementById("hideannotationicons"))||void 0===_document$getElementB?void 0:_document$getElementB.focus()}),0)})),iconHide&&iconHide.addEventListener("click",(e=>{e.preventDefault(),this.showAnnotationIcons(!1),setTimeout((()=>{var _document$getElementB2;return null===(_document$getElementB2=document.getElementById("showannotationicons"))||void 0===_document$getElementB2?void 0:_document$getElementB2.focus()}),0)}));const annoSpans=document.querySelectorAll("span.ouwiki-annotation-tag");annoSpans.length>0&&(this.ouwikiShowAllAnnotations("none"),annoSpans.forEach((span=>this.setupSpans(span))));document.getElementById("ouw_create")&&this.ouwikiSetFields(),this.setupExpandCollapseAnnotations()}showAnnotationIcons(show){var _document$querySelect,_document$querySelect2;const pending=new _pending.default("mod_ouwiki/showannotationicons"),container=document.querySelector(".ouwiki-content");container&&(show?container.classList.remove("ouwiki-hide-annotations"):container.classList.add("ouwiki-hide-annotations"));const url=show?null===(_document$querySelect=document.querySelector("#showannotationicons"))||void 0===_document$querySelect?void 0:_document$querySelect.href:null===(_document$querySelect2=document.querySelector("#hideannotationicons"))||void 0===_document$querySelect2?void 0:_document$querySelect2.href;url&&(fetch("".concat(url,"&ajax=1")),pending.resolve())}async ouwikiSetFields(){const createButton=document.getElementById("ouw_create"),pageName=document.getElementById("ouw_newpagename"),addButton=document.getElementById("ouw_add"),sectionName=document.getElementById("ouw_newsectionname"),typeInPageName=await(0,_str.getString)("typeinpagename","ouwiki"),typeInSectionName=await(0,_str.getString)("typeinsectionname","ouwiki");createButton&&pageName&&(createButton.disabled=!0,pageName.style.color="gray",pageName.value=typeInPageName,pageName.addEventListener("focus",(()=>this.ouwikiResetField(pageName))),pageName.addEventListener("keyup",(()=>this.ouwikiClearDisabled(createButton,pageName)))),addButton&&sectionName&&(addButton.disabled=!0,sectionName.style.color="gray",sectionName.value=typeInSectionName,sectionName.addEventListener("focus",(()=>this.ouwikiResetField(sectionName))),sectionName.addEventListener("keyup",(()=>this.ouwikiClearDisabled(addButton,sectionName))))}ouwikiClearDisabled(button,field){button.disabled=!field.value.trim()}ouwikiResetField(field){"gray"===field.style.color&&(field.value="",field.style.color="black")}async ouwikiShowAllAnnotations(action){const annoBoxes=document.querySelectorAll("span.ouwiki-annotation"),collapseAnnotation=await(0,_str.getString)("collapseannotation","ouwiki"),expandAnnotation=await(0,_str.getString)("expandannotation","ouwiki");annoBoxes.forEach((box=>{box.style.display=action;const imgTag=box.parentNode.querySelector("img");imgTag&&(imgTag.alt="block"===action?collapseAnnotation:expandAnnotation,imgTag.title="block"===action?collapseAnnotation:expandAnnotation)})),"block"===action?this.ouwikiSwapAnnotationUrl("hide"):this.ouwikiSwapAnnotationUrl("show")}ouwikiSwapAnnotationUrl(action){const show=document.getElementById("expandallannotations"),hide=document.getElementById("collapseallannotations");show&&hide&&("hide"===action?(show.style.display="none",hide.style.display="inline"):(show.style.display="inline",hide.style.display="none"))}setupExpandCollapseAnnotations(){document.querySelectorAll("#expandcollapseannotations a").forEach((link=>{link.addEventListener("click",(e=>{e.preventDefault();const action=link.dataset.action;"expand"===action?this.ouwikiShowAllAnnotations("block"):"collapse"===action&&this.ouwikiShowAllAnnotations("none")}))}))}setupSpans(span){span.style.cursor="pointer",span.tabIndex=0,span.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(this.ouwikiShowHideAnnotation("annotationbox".concat(span.id.substring(10))),e.preventDefault())})),span.addEventListener("click",(()=>{this.ouwikiShowHideAnnotation("annotationbox".concat(span.id.substring(10)))}))}async ouwikiShowHideAnnotation(id){const box=document.getElementById(id),imgTag=box.parentNode.querySelector("img");if("block"===box.style.display)box.style.display="none",imgTag.alt=await(0,_str.getString)("expandannotation","ouwiki"),imgTag.title=await(0,_str.getString)("expandannotation","ouwiki"),this.ouwikiSwapAnnotationUrl("show");else{box.style.display="block",imgTag.alt=await(0,_str.getString)("collapseannotation","ouwiki"),imgTag.title=await(0,_str.getString)("collapseannotation","ouwiki");const annoBoxes=document.querySelectorAll("span.ouwiki-annotation");Array.from(annoBoxes).every((el=>"block"===el.style.display))&&this.ouwikiSwapAnnotationUrl("hide")}}}_exports.init=()=>{(new Main).init()}}));

//# sourceMappingURL=main.min.js.map